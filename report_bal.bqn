âŸ¨ReportBalâŸ©â‡

# calculate account balance
CalcBalPlain â† {
    # sort/ group accounts
	s â† ğ•©âŠËœâ‹1âŠË˜ğ•©
	# last in group?
	l â† â‰¢Â¨âŸœÂ«1âŠË˜s
	# merge dependent cumulative sums and accounts
	âˆ¾â‰âŸ¨â‰â‰l/1âŠË˜s,-âŸœÂ»l/+`2â†“Ë˜sâŸ©
}

AccountParents â† {{ğ•¨âˆ¾":"âˆ¾ğ•©}`ğ•©âŠ”Ëœ1-Ëœ(ğ•©â‰ ':')Ã—1++`ğ•©=':'}

# Add balances to parents and then reapply cumulation
CalcBal â† {
    AccountBF â† {p â† AccountParents âŠ‘1â†‘ğ•© â‹„ <âˆ¾â‰âŸ¨â‰â‰p, (â‰ p)/â‰1â†“â¥Šğ•©âŸ©}
	s         â† {{âŸ¨âŸ©â‰¢ğ•©}Â¨âŠË˜ğ•©}âŠ¸/CalcBalPlain ğ•©
	b         â† âŠËœâŸœ{â‹1â†‘Ë˜ğ•©}âˆ¾Â´AccountBFË˜s
	CalcBalPlain âˆ¾â‰âŸ¨+`â‰¢Â¨âŸœÂ»1â†‘Ë˜b, bâŸ©
}

# Add total row to bal report
BalTotals â† {t â† +Â´Ë˜â‰1â†“Ë˜ğ•© â‹„ ğ•©âˆ¾tâˆ¾Ëœ<"Total"}

ReportBal â† {comâ€¿balâ€¿prices: BalTotals CalcBal bal}